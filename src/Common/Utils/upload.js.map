{"version":3,"sources":["upload.es6"],"names":[],"mappings":";;;;;;;;;;IAGM,M;;;;;;;4BAEQ,G,EAAK,K,EAAO,gB,EAAkB;;AAEpC,mBAAO,IAAI,OAAJ,CAAY,UAAU,OAAV,EAAmB,MAAnB,EAA2B;AAC1C,oBAAI,MAAM,KAAN,CAAY,MAAZ,IAAsB,CAA1B,EAA6B;AACzB,0BAAM,WAAN;AACA;AACH;;AAED,oBAAI,aAAa,IAAI,QAAJ,EAAjB;AACA,qBAAK,IAAI,IAAI,CAAb,EAAgB,IAAI,MAAM,KAAN,CAAY,MAAhC,EAAwC,GAAxC,EAA6C;AACzC,+BAAW,MAAX,CAAkB,CAAlB,EAAqB,MAAM,KAAN,CAAY,CAAZ,CAArB;AACH;AACD,oBAAI,MAAM,IAAI,cAAJ,EAAV;AACA,oBAAI,MAAJ,CAAW,gBAAX,CAA4B,UAA5B,EAAwC,UAAU,GAAV,EAAe;AACnD,wBAAI,IAAI,gBAAR,EAA0B;AACtB,4BAAI,kBAAkB,KAAK,KAAL,CAAW,IAAI,MAAJ,GAAa,GAAb,GAAmB,IAAI,KAAlC,CAAtB;AACA,yCAAiB,eAAjB;AACH;AACJ,iBALD,EAKG,KALH;AAMA,oBAAI,gBAAJ,CAAqB,MAArB,EAA6B,UAAU,GAAV,EAAe;AACxC,wBAAI,SAAS,IAAI,MAAJ,CAAW,YAAxB;AACA,wBAAI,mBAAJ;AACA,wBAAI;AACA,qCAAa,OAAO,MAAP,EAAb;AACH,qBAFD,CAEE,OAAO,CAAP,EAAU;AACR,4BAAI,gBAAgB,sBAApB;AACA,+BAAO,aAAP;AACA;AACH;AACD,wBAAI,WAAW,OAAX,IAAsB,MAA1B,EAAkC;AAC9B;AACH,qBAFD,MAEO;AACH,4BAAI,iBAAgB,mBAAmB,WAAW,OAAlD;AACA,+BAAO,cAAP;AACH;AACJ,iBAhBD,EAgBG,KAhBH;AAiBA,oBAAI,gBAAJ,CAAqB,OAArB,EAA8B,YAAY;AACtC,wBAAI,gBAAgB,kCAApB;AACA,2BAAO,aAAP;AACH,iBAHD,EAGG,KAHH;AAIA,oBAAI,gBAAJ,CAAqB,OAArB,EAA8B,YAAY;AACtC,wBAAI,gBAAgB,cAApB;AACA,2BAAO,aAAP;AACH,iBAHD,EAGG,KAHH;AAIA,oBAAI,IAAJ,CAAS,MAAT,EAAiB,GAAjB;AACA,oBAAI,IAAJ,CAAS,UAAT;AACH,aA5CM,CAAP;AA6CH;;;;;;AAGL,OAAO,OAAP,GAAiB,MAAjB","file":"upload.js","sourcesContent":["/**\r\n * Created by karl on 2016/7/29.\r\n */\r\nclass upload {\r\n\r\n    static do(url, input, progressCallback) {\r\n\r\n        return new Promise(function (resolve, reject) {\r\n            if (input.files.length == 0) {\r\n                alert(\"请至少选择一个文件\");\r\n                return;\r\n            }\r\n\r\n            let uploadFile = new FormData();\r\n            for (let i = 0; i < input.files.length; i++) {\r\n                uploadFile.append(i, input.files[i]);\r\n            }\r\n            let xhr = new XMLHttpRequest();\r\n            xhr.upload.addEventListener(\"progress\", function (evt) {\r\n                if (evt.lengthComputable) {\r\n                    let percentComplete = Math.round(evt.loaded * 100 / evt.total);\r\n                    progressCallback(percentComplete);\r\n                }\r\n            }, false);\r\n            xhr.addEventListener(\"load\", function (evt) {\r\n                let result = evt.target.responseText;\r\n                let jsonObject;\r\n                try {\r\n                    jsonObject = result.toJson();\r\n                } catch (e) {\r\n                    let rejectMessage = \"invalid json message\";\r\n                    reject(rejectMessage);\r\n                    return;\r\n                }\r\n                if (jsonObject.success == \"true\") {\r\n                    resolve();\r\n                } else {\r\n                    let rejectMessage = \"upload failed:\" + jsonObject.message;\r\n                    reject(rejectMessage);\r\n                }\r\n            }, false);\r\n            xhr.addEventListener(\"error\", function () {\r\n                let rejectMessage = \"upload failed:check your network\";\r\n                reject(rejectMessage);\r\n            }, false);\r\n            xhr.addEventListener(\"abort\", function () {\r\n                let rejectMessage = \"upload abort\";\r\n                reject(rejectMessage);\r\n            }, false);\r\n            xhr.open(\"POST\", url);\r\n            xhr.send(uploadFile);\r\n        });\r\n    }\r\n}\r\n\r\nmodule.exports = upload;"]}