{"version":3,"sources":["configInit.es6"],"names":[],"mappings":"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","file":"configInit.js","sourcesContent":["let xml = require(\"karl-xml\");\r\nlet promise1 = xml.read(\"./server/config/account.xml\");\r\nlet promise2 = xml.read(\"./server/config/mysql.xml\");\r\nPromise.all([promise1, promise2]).then(d=> {\r\n    global.accountConfig = {\r\n        username: d[0].root.username[0],\r\n        password: d[0].root.password[0],\r\n        usernameCookie: d[0].root.usernameCookie[0],\r\n        passwordCookie: d[0].root.passwordCookie[0],\r\n        loginRedirect: d[0].root.loginRedirect[0]\r\n    };\r\n\r\n    let mysql = require(\"../../util/mysql\");\r\n    mysql.init(\"localhost\", d[1].root.user[0], d[1].root.password[0], d[1].root.database[0]);\r\n    console.log(\"mysql init success\");\r\n    global.log.server.info(\"mysql init success\");\r\n\r\n    mysql.excuteQuery(\"show tables\").then(function (d) {\r\n        let tableNames = d.map(d1=> {\r\n            let tableName;\r\n            for (let k in d1) {\r\n                tableName = d1[k];\r\n                break;\r\n            }\r\n            return tableName;\r\n        });\r\n        let descTablePromise = [];\r\n        tableNames.map(d1=> {\r\n            descTablePromise.push(mysql.excuteQuery(\"desc \" + d1));\r\n        });\r\n        global.dbStruct = [];\r\n        Promise.all(descTablePromise).then(d1=> {\r\n            for (let i = 0; i < d1.length; i++) {\r\n                let tableName = tableNames[i];\r\n                let tableDesc = d1[i];\r\n                global.dbStruct.push({id: tableName, fields: tableDesc});\r\n            }\r\n            console.log(\"get database structure successfully\");\r\n            global.log.server.info(\"get database structure successfully\");\r\n        }).catch(d1=> {\r\n            console.log(\"get table structure failed:\");\r\n            console.log(d1);\r\n            global.log.error.info(\"get table structure failed:\");\r\n            global.log.error.info(d1);\r\n        });\r\n    }).catch(function (d) {\r\n        console.log(\"get database structure failed:\");\r\n        console.log(d);\r\n        global.log.error.info(\"get database structure failed:\");\r\n        global.log.error.info(d);\r\n    });\r\n}).catch(d=> {\r\n    console.log(d);\r\n    global.log.error.info(d);\r\n});\r\n\r\nmodule.exports = \"\";"]}