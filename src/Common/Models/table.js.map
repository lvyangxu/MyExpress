{"version":3,"sources":["table.es6"],"names":[],"mappings":"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","file":"table.js","sourcesContent":["let response = require(\"./response\");\r\nlet tableMap = require(\"./tableMap\");\r\nlet fs = require(\"fs\");\r\n\r\nmodule.exports = {\r\n    init: (req, res, table)=> {\r\n        let d = tableMap.init(table);\r\n        if (d.length == 0) {\r\n            response.fail(res, \"unknown table\");\r\n        } else {\r\n            response.success(res, d);\r\n        }\r\n    },\r\n    create: (req, res, table, map)=> {\r\n        let {sqlCommand, values} = map;\r\n        global.mysql.excuteQuery(sqlCommand, values).then(d=> {\r\n            response.success(res);\r\n        }).catch(d=> {\r\n            console.log(\"mysql excuteQuery error:\" + d);\r\n            console.log(sqlCommand);\r\n            console.log(values);\r\n            response.fail(res, \"mysql excuteQuery error\");\r\n        });\r\n    },\r\n    update: (req, res, table, map)=> {\r\n        let [sqlCommandArr, valuesArr] = [map.sqlCommand, map.values];\r\n        let promiseArr = [];\r\n        for (let i = 0; i < sqlCommandArr.length; i++) {\r\n            let sqlCommand = sqlCommandArr[i];\r\n            let values = valuesArr[i];\r\n            promiseArr.push(global.mysql.excuteQuery(sqlCommand, values));\r\n        }\r\n        Promise.all(promiseArr).then(d=> {\r\n            response.success(res);\r\n        }).catch(d=> {\r\n            console.log(\"mysql excuteQuery error:\" + d);\r\n            console.log(sqlCommandArr);\r\n            console.log(valuesArr);\r\n            response.fail(res, \"mysql excuteQuery error\");\r\n        });\r\n    },\r\n    read: (req, res, table, map)=> {\r\n        let {sqlCommand, values} = map;\r\n        global.mysql.excuteQuery(sqlCommand, values).then(d=> {\r\n            d = tableMap.dataMap(table, d);\r\n            response.success(res, d);\r\n        }).catch(d=> {\r\n            console.log(\"mysql excuteQuery error:\" + d);\r\n            console.log(sqlCommand);\r\n            console.log(values);\r\n            response.fail(res, \"mysql excuteQuery error\");\r\n        });\r\n    },\r\n    delete: (req, res, table)=> {\r\n        let sqlCommand = \"delete from \" + table + \" where id in (\" + req.body.id + \")\";\r\n        global.mysql.excuteQuery(sqlCommand, {}).then(d=> {\r\n            response.success(res, d);\r\n        }).catch(d=> {\r\n            console.log(\"mysql excuteQuery error:\" + d);\r\n            console.log(sqlCommand);\r\n            response.fail(res, \"mysql excuteQuery error\");\r\n        });\r\n    },\r\n    attachmentRead: (req, res, table)=> {\r\n        let path = \"./client/data/\" + table + \"/\" + req.body.id + \"/\";\r\n        if (fs.existsSync(path)) {\r\n            let attachementList = fs.readdirSync(path);\r\n            attachementList = attachementList.map(d=> {\r\n                d = d.base64Encode();\r\n                return d;\r\n            });\r\n            response.success(res, attachementList);\r\n        } else {\r\n            response.success(res, []);\r\n        }\r\n    },\r\n    attachmentDelete: (req, res, table)=> {\r\n        let name = req.body.name;\r\n        let path = \"./client/data/\" + table + \"/\" + req.body.id + \"/\";\r\n        if (fs.existsSync(path)) {\r\n            fs.unlinkSync(path + name);\r\n            response.success(res);\r\n        } else {\r\n            response.fail(res, \"dir do not exist\");\r\n        }\r\n\r\n    },\r\n    attachmentUpload: (req, res, table)=> {\r\n        if (req.files[0] == undefined) {\r\n            response.fail(\"no file\");\r\n            return;\r\n        }\r\n        let sourcePath = \"./server/upload/\";\r\n        let destPath = \"./client/data/\" + table + \"/\";\r\n        if(!fs.existsSync(destPath)){\r\n            fs.mkdirSync(destPath);\r\n        }\r\n        destPath += req.query.id + \"/\";\r\n        if(!fs.existsSync(destPath)){\r\n            fs.mkdirSync(destPath);\r\n        }\r\n        let filename = req.files[0].filename;\r\n        fs.renameSync(sourcePath + filename, destPath + filename);\r\n        response.success(res);\r\n    },\r\n};"]}